<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" creationComplete="doInit();">

	<mx:Script>
		<![CDATA[
			import mx.rpc.events.ResultEvent;
			//Imported Classes
			import mx.controls.Alert;
		    import mx.events.ValidationResultEvent;
		    import mx.rpc.events.AbstractEvent;
		    import mx.rpc.events.FaultEvent;
		    import mx.utils.ObjectUtil;
		    import flash.events.*;
		    import mx.managers.PopUpManager;
		    import mx.core.IFlexDisplayObject;
		    import mx.events.CloseEvent;
		    import mx.rpc.Fault;

			// DEFINE VARS FOR STORING VALIDATION OBJECTS
	        private var VuserName:ValidationResultEvent
	        private var Vpassword:ValidationResultEvent 
	        private var Vfirst_name:ValidationResultEvent 
	        private var Vlast_name:ValidationResultEvent 
	        private var Vemail:ValidationResultEvent 
	        
	        // CENTER POPUP 
			private function doInit():void
			{
				PopUpManager.centerPopUp(this);
			}

			// REMOVE POPUP
			private function removeWindow():void
			{
				PopUpManager.removePopUp(this);
			}

			// CALL ADD USER MEHTOD
			private function addUser():void
			{
				UserManager.add();
			}	
			
			// HANDLE ADD USER RESULTS
			private function addResult(event:ResultEvent):void
			{
				Alert.show(event.result as String);
			}

			// HANDLE ADD USER FAULTS
			private function addFault(event:FaultEvent):void
			{
				Alert.show("An error occured","Program Error")
			}

			// CALL EDIT USER METHOD
			private function editUser():void
			{
				UserManager.edit();
			}

			// HANDLE EDIT USER RESULTS
			private function editResult(event:ResultEvent):void
			{
				Alert.show(event.result as String);
			}

			// HANDLE EDIT USER FAULT
			private function editFault(event:FaultEvent):void
			{
				Alert.show("An error occured","Program Error")
			}

			
			// CALL DELETE USER METHOD
			private function removeUser():void
			{
				UserManager.remove();
			}
			
			// HANDLE DELETE USER RESULTS
			private function removeResult(event:ResultEvent):void
			{
				Alert.show(event.result as String);
				clearScreen();
			}
			
			// HANDLE DELETE USER FAULT
			private function removeFault(event:FaultEvent):void
			{
				Alert.show("An error occured","Program Error")
			}
			
			// DELETE USER HANDLER
			private function removeUserHandler():void
			{
				if (uuid.text.length > 0) removeUser();
				else Alert.show("Unable to delete user, new user creation is loaded");
			}
	        
			// FUNCTION TO VALIDATE, IF VALID SAVE FORM, IF NOT VALID SHOW ERRORS  
	 		private function userSaveValidation():void
	 		{
	        	// Validate FORM INPUTS
	           VuserName = loginVal.validate(); 
	           Vpassword = passVal.validate(); 
	           Vfirst_name = first_nameVal.validate(); 
	           Vlast_name = last_nameVal.validate(); 
	           Vemail = emailVal.validate(); 
	           
	           if (VuserName.type==ValidationResultEvent.INVALID || Vpassword.type==ValidationResultEvent.INVALID ||
	          	   Vfirst_name.type==ValidationResultEvent.INVALID || Vlast_name.type==ValidationResultEvent.INVALID || 
	          	   Vemail.type==ValidationResultEvent.INVALID){
	           	return;
	           }
	           else {
	    			if (uuid.text.length > 0) editUser();
	    			else addUser();
	           }
	        } 

			private function clearScreen():void
			{
					removeWindow();
					uuid.text = '';
					login.text = ''; 
					pass.text = '';
					first_name.text = '';
					last_name.text = ''; 
					email.text = ''; 
					url.text = '';
			}
		]]>
	</mx:Script>
	
	<!-- SEARCH WEBSERVICE -->
	<mx:WebService id="UserManager" useProxy="false" 
		wsdl="http://localhost/services/UserManager.cfc?wsdl"
		showBusyCursor="true">
		
		<mx:operation name="add" 
			result="addResult(event)" 
			fault="addFault(event)">
			<mx:request>
				<login>{login.text}</login>
				<pass>{pass.text}</pass>
	            <first_name>{first_name.text}</first_name>
	            <last_name>{last_name.text}</last_name>
	            <email>{email.text}</email>
	            <url>{url.text}</url>
        	</mx:request>
		</mx:operation>
			
		<mx:operation name="edit" 
			result="editResult(event)" 
			fault="editFault(event)">
			<mx:request>
				<id>{uuid.text}</id>
				<login>{login.text}</login>
				<pass>{pass.text}</pass>
	            <first_name>{first_name.text}</first_name>
	            <last_name>{last_name.text}</last_name>
	            <email>{email.text}</email>
	            <url>{url.text}</url>
        	</mx:request>
		</mx:operation>
			
		<mx:operation name="remove" 
			result="removeResult(event)" 
			fault="removeFault(event)">
			<mx:request>
				<id>{uuid.text}</id>
			</mx:request>
		</mx:operation>
			
	</mx:WebService>
    
     <mx:Form width="100%" height="100%">
        <mx:FormHeading label="Please fill in all required forms below."/>

        <mx:FormItem required="true" label="Username:">
            <mx:TextInput width="200" id="login"/>
        </mx:FormItem>

        <mx:FormItem required="true" label="Password:">
            <mx:TextInput id="pass" width="200" displayAsPassword="true"/>
        </mx:FormItem>

        <mx:FormItem required="true" label="First Name:">
            <mx:TextInput id="first_name" width="200"/>
        </mx:FormItem>

        <mx:FormItem required="true" label="Last Name:">
            <mx:TextInput id="last_name" width="200"/>
        </mx:FormItem>

        <mx:FormItem required="true" label="Email Address:">
            <mx:TextInput id="email" width="200"/>
        </mx:FormItem>

        <mx:FormItem  label="Website:">
            <mx:TextInput id="url" width="200"/>
        </mx:FormItem>
        
        <mx:FormItem visible="false">
   			<mx:TextInput id="uuid" />
        </mx:FormItem>
    </mx:Form>
        
        <!-- VALIDATORS -->
	<mx:StringValidator source="{login}" required="true" id="loginVal" property="text" minLength="1" maxLength="20" />
	<mx:StringValidator source="{pass}" required="true" id="passVal" property="text" minLength="1" maxLength="20" />
	<mx:StringValidator source="{first_name}" required="true" id="first_nameVal" property="text" minLength="1" maxLength="20" />
	<mx:StringValidator source="{last_name}" required="true" id="last_nameVal" property="text" minLength="1" maxLength="20" />
	<mx:StringValidator source="{email}" required="true" id="emailVal" property="text" minLength="1" maxLength="20" />
	
	<mx:ApplicationControlBar x="0" width="100%"  height="35" borderStyle="solid">
		<mx:Button label="Save" click="userSaveValidation()" />
		<mx:Button label="Exit" click="clearScreen()"/>
		<mx:Button label="Delete" click="removeUserHandler()" />
	</mx:ApplicationControlBar>
</mx:TitleWindow>
