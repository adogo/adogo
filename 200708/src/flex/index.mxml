<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml"
				layout="absolute"
				creationComplete="initApp()">

	<mx:Script>
		<![CDATA[
			import mx.events.DataGridEvent;
			import mx.events.DataGridEventReason;
			import mx.rpc.events.ResultEvent;
			import mx.controls.Alert;
			import mx.collections.ArrayCollection;
			import mx.controls.TextInput;
			
			[Bindable]private var members : Array = new Array();

			private function initApp() : void {
				MemberService.getAll();
			}
			
			public function update(event : DataGridEvent) : void {       
				if(event.reason == DataGridEventReason.CANCELLED) return; 

				if (event.rowIndex > 0) {
					arguments[event.dataField] = TextInput(event.currentTarget.itemEditorInstance).text;
					arguments['id'] = membersDG.selectedItem.ID;
	   
					if( membersDG.selectedItem[event.dataField] == arguments[event.dataField]) return;
	
					MemberService.update(arguments);	
				}
			}
		]]>
	</mx:Script>



	<mx:WebService   id="MemberService" 
					 wsdl="http://adogo/coldfusion/remote/MemberServiceRemote.cfc?wsdl"
					 showBusyCursor="true">
		<mx:operation name="create" />
		<mx:operation name="getAll" result="members = event.result as Array;"/>
		<mx:operation name="update" fault="Alert.show(event.fault.toString())"  />
	</mx:WebService>


	
	<mx:Panel width="800" height="300" layout="absolute" horizontalCenter="0" verticalCenter="0" title="Manage Tables">
		<mx:TabNavigator left="10" top="10" right="10" bottom="10">
			<mx:Canvas label="Members" width="100%" height="100%">
				<mx:DataGrid id="membersDG" height="100%" y="0" width="100%" x="0" dataProvider="{members}" editable="true" itemEditEnd="update(event)">
					<mx:columns>
						<mx:DataGridColumn dataField="ID" headerText="ID" editable="false" />
						<mx:DataGridColumn dataField="USERNAME" headerText="Username" />
						<mx:DataGridColumn dataField="FIRSTNAME" headerText="First Name" />
						<mx:DataGridColumn dataField="LASTNAME" headerText="Last Name" />
						<mx:DataGridColumn dataField="BIRTHDATE" headerText="BirthDate" />
						<mx:DataGridColumn dataField="EMAIL" headerText="Email" />
					</mx:columns>
				</mx:DataGrid>
			</mx:Canvas>
		</mx:TabNavigator>
	</mx:Panel>
</mx:Application>